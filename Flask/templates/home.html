{% extends 'base.html' %}

{% block title %}Home - CERTIFY{% endblock %}

{% block content %}
<!-- ✅ Background Section -->
<div class="picture">
    <div class="text-box">
        <h1 class="fw-bold">CERTIFY</h1>
        <p>Where Every Show Begins</p>
        <a href="{{ url_for('dashboard') }}" class="hero-btn">BOOK NOW</a>
    </div>
</div>
    
<!-- ✅ Venues Section -->
<div class="main-content container-fluid py-4">
    <h2 class="text-center fw-bold mb-4">VENUES</h2>

    <div class="row g-4">
        {% for venue in venues %}
        <div class="col-lg-4 col-md-6 col-sm-12">
            <div class="card shadow p-3 h-100">
                <!-- ✅ Venue Image -->
                <img src="{{ url_for('static', filename='images/' + venue.name|replace(' ', '_') + '.jpg') }}" 
                     class="card-img-top" 
                     alt="{{ venue.name }}" 
                     style="height: 200px; object-fit: cover;">

                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">{{ venue.name }}</h5>
                    <p class="card-text"><strong>Location:</strong> {{ venue.location }}</p>
                    <p class="card-text"><strong>Capacity:</strong> {{ venue.capacity }} seats</p>

                    <p class="card-text"><strong>Pricing:</strong></p>
                    <ul class="list-unstyled">
                        <li>Morning: ₱{{ "{:,.2f}".format(venue.morning_price) }}</li>
                        <li>Afternoon: ₱{{ "{:,.2f}".format(venue.afternoon_price) }}</li>
                        <li>Evening: ₱{{ "{:,.2f}".format(venue.evening_price) }}</li>
                    </ul>

                    <a href="{{ url_for('dashboard') }}" class="btn btn-primary mt-auto">Book Now</a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- ✅ Events Section -->
<div class="ms-3 me-3 pt-3">
    <h2 class="text-center fw-bold mb-4">Upcoming Events</h2>

    <!-- ✅ Sorting Dropdown -->
    <div class="mb-4 text-center">
        <label for="sort" class="fw-bold">Sort by:</label>
        <select id="sort" class="form-select w-auto d-inline-block" onchange="sortEvents()">
            <option value="date" {% if request.args.get('sort', 'date') == 'date' %}selected{% endif %}>Date</option>
            <option value="time_slot" {% if request.args.get('sort') == 'time_slot' %}selected{% endif %}>Time Slot</option>
            <option value="venue" {% if request.args.get('sort') == 'venue' %}selected{% endif %}>Venue</option>
            <option value="agency" {% if request.args.get('sort') == 'agency' %}selected{% endif %}>Agency</option>
            <option value="all" {% if request.args.get('sort') == 'all' %}selected{% endif %}>All</option>
        </select>
    </div>

    <!-- ✅ Events Table -->
    <div class="table-responsive">
        <table class="table table-hover text-center align-middle">
            <thead class="table-dark sticky-header">
                <tr>
                    <th>Venue</th>
                    <th>Concert Title</th>
                    <th>Artist</th>
                    <th>Agency</th>
                    <th>Date</th>
                    <th>Time Slot</th>
                </tr>
            </thead>
            <tbody id="events-table">
                {% for event in events %}
                <tr {% if event.date < today and request.args.get('sort') != 'all' %}style="display: none;"{% endif %}>
                    <td>{{ event.venue.name }}</td>
                    <td>{{ event.concert_title }}</td>
                    <td>{{ event.artist_name }}</td>
                    <td>{{ event.user.agency_name }}</td>
                    <td>{{ event.date }}</td>
                    <td>{{ event.time_slot }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>    
</div>

<!-- ✅ Sorting JavaScript with Scroll Position Fix -->
<script>
    function sortEvents() {
        let sortValue = document.getElementById("sort").value;

        // Save scroll position before reloading
        localStorage.setItem("scrollPosition", window.scrollY);

        // Redirect with sorting parameter
        window.location.href = "{{ url_for('home') }}?sort=" + sortValue;
    }

    // Restore scroll position after page reloads
    window.onload = function () {
        let scrollPosition = localStorage.getItem("scrollPosition");
        if (scrollPosition !== null) {
            window.scrollTo(0, scrollPosition); // Restore scroll position
            localStorage.removeItem("scrollPosition"); // Remove storage after restoring
        }
    };
</script>

{% endblock %}
